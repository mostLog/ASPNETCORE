@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
   
    <!--引入element ui样式-->
    <link rel="stylesheet" href="https://cdn.bootcss.com/element-ui/2.0.5/theme-chalk/index.css">
    <base target="_blank">
    <style>
        .layui-table-view {
            margin: 0px;
        }
    </style>
</head>
<body style="padding:15px;">
    <div id="app">
        <el-row>
            <el-col :span="6">
                <div >
                    <div>
                        <el-button type="primary" v-on:click="addNode" icon="el-icon-circle-plus-outline">添加</el-button>
                        <el-button type="danger" v-on:click="removeNode" icon="el-icon-delete">删除</el-button>
                    </div>
                    <div style="margin: 10px 0px;width:99%;">
                        <el-input placeholder="输入分类名称进行过滤"
                                  v-model="filterText">
                        </el-input>
                    </div>
                    <el-tree :data="treeData"
                             :props="defaultProps"
                             :load="lazyLoadNode"
                             accordion
                             show-checkbox
                             highlight-current
                             lazy
                             ref="tree"
                             :filter-node-method="filterNode"
                             :expand-on-click-node="false"
                             v-on:node-click="handleNodeClick">
                    </el-tree>
                </div>
            </el-col>
            <el-col :span="18">
                <div >
                    <div>
                        <el-button type="primary" icon="el-icon-circle-plus-outline">添加</el-button>
                        <el-button type="danger" icon="el-icon-delete">删除</el-button>
                    </div>
                    <div style="margin: 10px 0px;width:99%;">
                        <el-input placeholder="请输入类别名称" style="width:200px;"></el-input>
                    </div>
                    <template>
                        <el-table :data="tableData"
                                  border
                                  style="width: 100%">
                            <el-table-column type="selection"
                                             header-align="center"
                                             width="55">
                            </el-table-column>
                            <el-table-column prop="name"
                                             header-align="center"
                                             label="类别名称"
                                             width="180">
                            </el-table-column>
                            <el-table-column prop="value"
                                             label="值"
                                             header-align="center"
                                             width="180">
                            </el-table-column>
                            <el-table-column prop="remark"
                                             header-align="center"
                                             label="备注">
                            </el-table-column>
                            <el-table-column prop="createDateTime"
                                             header-align="center"
                                             width="180"
                                             label="创建时间">
                            </el-table-column>
                        </el-table>
                    </template>
                </div>
            </el-col>
        </el-row>
      
    </div>
    <!-- 先引入 Vue -->
    <script src="https://cdn.bootcss.com/vue/2.5.9/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/vue-resource/1.3.4/vue-resource.min.js"></script>
    <!-- 引入组件库 -->
    <script src="https://cdn.bootcss.com/element-ui/2.0.5/index.js"></script>
    <script type="text/javascript">
        let id = 1000;
        var Main = {
            //监听器
            watch: {
                filterText(val) {
                    this.$refs.tree.filter(val);
                }
            },
            data() {
                return {
                    treeData: [],
                    tableData: [],
                    filterText: '',
                    fullscreenLoading: false,
                    defaultProps: {
                        children: 'dataTypeClasses',
                        label: 'name'
                    }
                };
            },
            //实例创建完成后立即调用
            created: function () {
                this.getRootNodes();
            },
            methods: {
                filterNode(value, data) {
                    if (!value) return true;
                    return data.name.indexOf(value) !== -1;
                },
                //获取所有节点信息
                getRootNodes() {
                    this.$http.get('/DataType/GetRootDataTypeClasses').then(
                        successResponse => {
                            this.treeData = successResponse.body;
                        },
                        failResponse => {

                        });
                },
                //赖加载子节点
                lazyLoadNode(node, resolve) {
                    if (node.level ===0) return resolve([]);
                    setTimeout(() => {
                        this.$http.get('/DataType/GetChildrenClasses', {
                            params: {
                                parentId: node.data.id
                            }
                        }).then(
                            successResponse => {
                                resolve(successResponse.body);
                            },
                            failResponse => {

                            });
                    }, 500);
                },
                //添加节点
                addNode() {
                    var selectedNode = this.$refs.tree.getCurrentNode();
                    var pClassId = selectedNode ? selectedNode.classId : "";
                    var pId = selectedNode ? selectedNode.id : "";
                    this.$prompt('请输入节点名称', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消'
                    }).then(({ value }) => {
                        this.$http.post('/DataType/AddDataTypeClass', {
                            name: value,
                            parentClassId: pClassId,
                            parentId: pId
                        }, { emulateJSON: true }).then(
                            successResponse => {
                                if (successResponse.body == 0) {
                                    this.$message({
                                        message: '添加成功',
                                        type: 'success'
                                    });
                                }
                            },
                            failResponse => {

                            });
                    }).catch(() => {
                        this.$message({
                            type: 'info',
                            message: '取消输入s'
                        });
                    });
                },
                //删除节点
                removeNode() {
                    var selectedNode = this.$refs.tree.getCurrentNode();
                    var pId = selectedNode ? selectedNode.id : "";
                    this.$http.post('/DataType/DelDataTypeClass', {
                        id: pId
                    }, { emulateJSON:true}).then(
                        successResponse => {
                            if (successResponse.body==0) {
                                this.$message({
                                    message: '删除成功',
                                    type: 'success'
                                });
                            }
                        },
                        failResponse => {

                        });
                },
                //点击节点触发事件
                handleNodeClick(data) {

                },
                //添加数据类型
                addDataType() {


                },
                delDataType() { 


                }
            }
        };
        var Ctor = Vue.extend(Main);
        new Ctor().$mount('#app');
    </script>
</body>
</html>